{% extends "base.html" %}
{% block content %}

{# ===== HERO SECTION ===== #}
{% if movies %}
{% set hero = movies[0] %}
<section class="hero">
  <div class="hero-bg" style="background-image:url('https://image.tmdb.org/t/p/original{{ hero.backdrop_path }}')"></div>
  <div class="hero-content container slide-up">
    <span class="hero-tag">
      <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2 3 14h9l-1 8 10-12h-9l1-8z"/></svg>
      Trending Now
    </span>
    <h1>{{ hero.title }}</h1>
    <div class="hero-meta">
      <span class="rating">
        <svg viewBox="0 0 24 24"><path d="m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01z"/></svg>
        {{ "%.1f"|format(hero.vote_average) }}
      </span>
      <span>{{ hero.release_date[:4] if hero.release_date else '' }}</span>
      {% if hero.original_language %}<span>{{ hero.original_language|upper }}</span>{% endif %}
    </div>
    <p class="hero-overview">{{ hero.overview }}</p>
    <div class="hero-actions">
      <a href="{{ url_for('main.movie_details', tmdb_id=hero.id) }}" class="btn btn-primary btn-lg">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        View Details
      </a>
      <button class="btn btn-secondary btn-lg" onclick="addToWatchlist({{ hero.id }})">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        My List
      </button>
    </div>
  </div>
</section>
{% endif %}

{# ===== GENRES ROW ===== #}
{% if genres %}
<section class="section">
  <div class="section-header">
    <h2 class="section-title">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="var(--accent)" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
      Browse by Genre
    </h2>
  </div>
  <div class="genre-row">
    {% for g in genres %}
    <a href="{{ url_for('main.genre', genre_id=g.id) }}" class="genre-pill">{{ g.name }}</a>
    {% endfor %}
  </div>
</section>
{% endif %}

{# ===== TRENDING ROW ===== #}
{% if movies %}
<section class="section">
  <div class="section-header">
    <h2 class="section-title">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M13 2 3 14h9l-1 8 10-12h-9l1-8z"/></svg>
      Trending This Week
    </h2>
    <a href="{{ url_for('main.trending') }}" class="section-link">See all â†’</a>
  </div>
  <div class="movie-row">
    <div class="row-arrow row-arrow-left" onclick="scrollRow(this, -1)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
    </div>
    <div class="movie-row-inner">
      {% for m in movies %}
      <a href="{{ url_for('main.movie_details', tmdb_id=m.id) }}" class="movie-card">
        <div class="mc-poster">
          {% if m.poster_path %}
          <img src="https://image.tmdb.org/t/p/w342{{ m.poster_path }}" alt="{{ m.title }}" loading="lazy">
          {% else %}
          <div class="placeholder">ðŸŽ¬</div>
          {% endif %}
        </div>
        <div class="mc-detail">
          <div class="mc-actions">
            <span class="mc-btn play"><svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21"/></svg></span>
          </div>
          <div class="mc-meta">
            <span class="match">{{ "%.0f"|format(m.vote_average * 10) }}% Match</span>
            <span>{{ m.release_date[:4] if m.release_date else '' }}</span>
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
    <div class="row-arrow row-arrow-right" onclick="scrollRow(this, 1)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
    </div>
  </div>
</section>
{% endif %}

{# ===== POPULAR ROW ===== #}
{% if popular_movies %}
<section class="section">
  <div class="section-header">
    <h2 class="section-title">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="var(--gold)" stroke-width="2"><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/><circle cx="12" cy="12" r="10"/></svg>
      Popular Right Now
    </h2>
    <a href="{{ url_for('main.popular') }}" class="section-link">See all â†’</a>
  </div>
  <div class="movie-row">
    <div class="row-arrow row-arrow-left" onclick="scrollRow(this, -1)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
    </div>
    <div class="movie-row-inner">
      {% for m in popular_movies %}
      <a href="{{ url_for('main.movie_details', tmdb_id=m.id) }}" class="movie-card">
        <div class="mc-poster">
          {% if m.poster_path %}
          <img src="https://image.tmdb.org/t/p/w342{{ m.poster_path }}" alt="{{ m.title }}" loading="lazy">
          {% else %}
          <div class="placeholder">ðŸŽ¬</div>
          {% endif %}
        </div>
        <div class="mc-detail">
          <div class="mc-actions">
            <span class="mc-btn play"><svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21"/></svg></span>
          </div>
          <div class="mc-meta">
            <span class="match">{{ "%.0f"|format(m.vote_average * 10) }}% Match</span>
            <span>{{ m.release_date[:4] if m.release_date else '' }}</span>
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
    <div class="row-arrow row-arrow-right" onclick="scrollRow(this, 1)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
    </div>
  </div>
</section>
{% endif %}

{# ===== PERSONALIZED RECOMMENDATIONS ===== #}
{% if recommendations %}
<section class="section">
  <div class="section-header">
    <h2 class="section-title">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="var(--purple)" stroke-width="2"><path d="m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01z"/></svg>
      Recommended for You
    </h2>
    <a href="{{ url_for('main.recommendations') }}" class="section-link">See all â†’</a>
  </div>
  <div class="movie-row">
    <div class="row-arrow row-arrow-left" onclick="scrollRow(this, -1)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
    </div>
    <div class="movie-row-inner">
      {% for m in recommendations %}
      <a href="{{ url_for('main.movie_details', tmdb_id=m.id) }}" class="movie-card">
        <div class="mc-poster">
          {% if m.poster_path or m.poster_url %}
          <img src="{{ m.poster_url or 'https://image.tmdb.org/t/p/w342' ~ m.poster_path }}" alt="{{ m.title }}" loading="lazy">
          {% else %}
          <div class="placeholder">ðŸŽ¬</div>
          {% endif %}
        </div>
        <div class="mc-detail">
          <div class="mc-actions">
            <span class="mc-btn play"><svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21"/></svg></span>
          </div>
          <div class="mc-meta">
            <span class="match">{{ "%.0f"|format(m.vote_average * 10) }}% Match</span>
            <span>{{ m.release_date[:4] if m.release_date else '' }}</span>
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
    <div class="row-arrow row-arrow-right" onclick="scrollRow(this, 1)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
    </div>
  </div>
</section>
{% endif %}

{# ===== STATS BAR (logged in) ===== #}
{% if stats %}
<section class="section container">
  <div class="stat-grid" style="margin-top:var(--sp-xl)">
    <div class="stat-card">
      <div class="stat-value">{{ stats.total_ratings or 0 }}</div>
      <div class="stat-label">Movies Rated</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ stats.total_reviews or 0 }}</div>
      <div class="stat-label">Reviews Written</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ stats.watchlist_count or 0 }}</div>
      <div class="stat-label">In Watchlist</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ "%.1f"|format(stats.average_rating or 0) }}</div>
      <div class="stat-label">Avg. Rating</div>
    </div>
  </div>
</section>
{% endif %}

{% endblock %}
