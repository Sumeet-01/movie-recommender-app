{% extends "base.html" %}
{% block content %}

<div class="page-header container">
  <h1>Discover Movies</h1>
  <p>Explore movies with advanced filters and sorting.</p>
</div>

{# Filters #}
<div class="filters-bar container">
  <form method="GET" action="{{ url_for('main.discover') }}" style="display:flex;gap:var(--sp-md);flex-wrap:wrap;align-items:center;width:100%">
    <select name="genre" class="filter-select">
      <option value="">All Genres</option>
      {% for g in genres %}
      <option value="{{ g.id }}" {% if current_filters.get('with_genres')|string == g.id|string %}selected{% endif %}>{{ g.name }}</option>
      {% endfor %}
    </select>

    <select name="sort_by" class="filter-select">
      <option value="popularity.desc" {% if current_filters.sort_by == 'popularity.desc' %}selected{% endif %}>Most Popular</option>
      <option value="vote_average.desc" {% if current_filters.sort_by == 'vote_average.desc' %}selected{% endif %}>Highest Rated</option>
      <option value="release_date.desc" {% if current_filters.sort_by == 'release_date.desc' %}selected{% endif %}>Newest First</option>
      <option value="revenue.desc" {% if current_filters.sort_by == 'revenue.desc' %}selected{% endif %}>Highest Grossing</option>
    </select>

    <select name="year" class="filter-select">
      <option value="">Any Year</option>
      {% for y in range(2025, 1979, -1) %}
      <option value="{{ y }}" {% if current_filters.get('year')|string == y|string %}selected{% endif %}>{{ y }}</option>
      {% endfor %}
    </select>

    <button type="submit" class="btn btn-accent btn-sm">Apply Filters</button>
    <a href="{{ url_for('main.discover') }}" class="btn btn-ghost btn-sm">Reset</a>
  </form>
</div>

{# Genre Pills #}
{% if genres %}
<div class="genre-row">
  <a href="{{ url_for('main.discover') }}" class="genre-pill {% if not current_filters.get('with_genres') %}active{% endif %}">All</a>
  {% for g in genres %}
  <a href="{{ url_for('main.discover', genre=g.id, sort_by=current_filters.sort_by) }}" class="genre-pill {% if current_filters.get('with_genres')|string == g.id|string %}active{% endif %}">{{ g.name }}</a>
  {% endfor %}
</div>
{% endif %}

{# Movies Grid #}
<div class="container">
  {% if movies %}
  <div class="movie-grid">
    {% for m in movies %}
    <a href="{{ url_for('main.movie_details', tmdb_id=m.id) }}" class="card-s">
      <div class="poster">
        {% if m.poster_path %}
        <img src="https://image.tmdb.org/t/p/w342{{ m.poster_path }}" alt="{{ m.title }}" loading="lazy">
        {% else %}
        <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:var(--bg-card);color:var(--text3);font-size:var(--fs-xl)">ðŸŽ¬</div>
        {% endif %}
        <div class="ov">
          <span class="score">
            <svg viewBox="0 0 24 24"><path d="m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01z"/></svg>
            {{ "%.1f"|format(m.vote_average) }}
          </span>
        </div>
      </div>
      <p class="c-title">{{ m.title }}</p>
      <p class="c-year">{{ m.release_date[:4] if m.release_date else '' }}</p>
    </a>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    <h2>No movies found</h2>
    <p>Try adjusting your filters or search criteria.</p>
    <a href="{{ url_for('main.discover') }}" class="btn btn-accent">Reset Filters</a>
  </div>
  {% endif %}
</div>

{% endblock %}
