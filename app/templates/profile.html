{% extends "base.html" %}
{% block content %}

<div class="container">
  {# Profile Header #}
  <div class="profile-header">
    <div class="profile-avatar-lg">{{ user.username[0]|upper }}</div>
    <div class="profile-info">
      <h1>{{ user.username }}</h1>
      {% if user.bio %}
      <p class="bio">{{ user.bio }}</p>
      {% endif %}
      <p style="font-size:var(--fs-xs);color:var(--text3);margin-top:var(--sp-xs)">
        Member since {{ user.created_at.strftime('%B %Y') if user.created_at else 'Recently' }}
      </p>
    </div>
  </div>

  {# Stats #}
  <div class="stat-grid">
    <div class="stat-card">
      <div class="stat-value">{{ stats.total_ratings or 0 }}</div>
      <div class="stat-label">Ratings</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ stats.total_reviews or 0 }}</div>
      <div class="stat-label">Reviews</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ stats.watchlist_count or 0 }}</div>
      <div class="stat-label">Watchlist</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ "%.1f"|format(stats.average_rating or 0) }}</div>
      <div class="stat-label">Avg Rating</div>
    </div>
  </div>

  {# Favorite Genres #}
  {% if favorite_genres %}
  <section class="section">
    <h2 class="section-title" style="padding:0 0 var(--sp-lg)">Favorite Genres</h2>
    <div style="display:flex;gap:var(--sp-sm);flex-wrap:wrap;padding:0">
      {% for genre_name, count in favorite_genres %}
      <span class="genre-chip">{{ genre_name }} <span style="opacity:.6">({{ count }})</span></span>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  {# Recent Ratings #}
  {% if recent_ratings %}
  <section class="section">
    <h2 class="section-title" style="padding:0 0 var(--sp-lg)">Recent Ratings</h2>
    <div class="movie-grid">
      {% for rating in recent_ratings %}
      {% if rating.movie %}
      <a href="{{ url_for('main.movie_details', tmdb_id=rating.movie.tmdb_id) }}" class="card-s">
        <div class="poster">
          {% if rating.movie.poster_path %}
          <img src="https://image.tmdb.org/t/p/w342{{ rating.movie.poster_path }}" alt="{{ rating.movie.title }}" loading="lazy">
          {% else %}
          <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:var(--bg-card);color:var(--text3);font-size:var(--fs-xl)">ðŸŽ¬</div>
          {% endif %}
          <div class="ov">
            <span class="score">
              <svg viewBox="0 0 24 24"><path d="m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01z"/></svg>
              {{ rating.score }}/10
            </span>
          </div>
        </div>
        <p class="c-title">{{ rating.movie.title }}</p>
      </a>
      {% endif %}
      {% endfor %}
    </div>
  </section>
  {% endif %}

  {# Recent Reviews #}
  {% if recent_reviews %}
  <section class="section">
    <h2 class="section-title" style="padding:0 0 var(--sp-lg)">Recent Reviews</h2>
    {% for r in recent_reviews %}
    <div class="review-card">
      <div class="review-header">
        <div class="review-avatar">{{ user.username[0]|upper }}</div>
        <div>
          <p class="review-author">{{ r.movie.title if r.movie else 'Movie' }}</p>
          <p class="review-date">{% if r.rating %}â˜… {{ r.rating }}/10{% endif %}</p>
        </div>
      </div>
      <p class="review-body">{{ r.content }}</p>
    </div>
    {% endfor %}
  </section>
  {% endif %}
</div>

{% endblock %}
